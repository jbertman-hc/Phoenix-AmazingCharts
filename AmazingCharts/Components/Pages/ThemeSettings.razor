@page "/theme-settings"
@using AmazingCharts.Services
@using AmazingCharts.Components.Shared
@inject ThemeService ThemeService
@inject ISnackbar Snackbar

<PageTitle>Theme Settings</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="py-4">
    <MudPaper Elevation="3" Class="pa-4 mb-4">
        <MudText Typo="Typo.h4" Class="mb-4">Theme Settings</MudText>
        
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudCard Elevation="0" Class="mb-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h5">Appearance</MudText>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudSwitch @bind-Checked="@ThemeService.IsDarkMode" Color="Color.Primary" Label="Dark Mode" />
                        
                        <MudText Typo="Typo.subtitle1" Class="mt-4 mb-2">Preview</MudText>
                        <MudPaper Elevation="0" Class="d-flex flex-wrap gap-4 py-4">
                            <MudButton Variant="Variant.Filled" Color="Color.Primary">Primary</MudButton>
                            <MudButton Variant="Variant.Filled" Color="Color.Secondary">Secondary</MudButton>
                            <MudButton Variant="Variant.Filled" Color="Color.Tertiary">Tertiary</MudButton>
                            <MudButton Variant="Variant.Filled" Color="Color.Info">Info</MudButton>
                            <MudButton Variant="Variant.Filled" Color="Color.Success">Success</MudButton>
                            <MudButton Variant="Variant.Filled" Color="Color.Warning">Warning</MudButton>
                            <MudButton Variant="Variant.Filled" Color="Color.Error">Error</MudButton>
                        </MudPaper>
                    </MudCardContent>
                </MudCard>
            </MudItem>
            
            <MudItem xs="12" md="6">
                <MudCard Elevation="0">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h5">UI Components</MudText>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudPaper Elevation="0" Class="d-flex flex-column gap-4">
                            <MudTextField T="string" Label="Text Field" Variant="Variant.Outlined" />
                            
                            <MudSelect T="string" Label="Select" Variant="Variant.Outlined">
                                <MudSelectItem Value="@("Option 1")">Option 1</MudSelectItem>
                                <MudSelectItem Value="@("Option 2")">Option 2</MudSelectItem>
                                <MudSelectItem Value="@("Option 3")">Option 3</MudSelectItem>
                            </MudSelect>
                            
                            <MudCheckBox T="bool" Label="Checkbox" Color="Color.Primary" />
                            
                            <MudRadioGroup T="string">
                                <MudRadio Option="@("Option 1")" Color="Color.Primary">Option 1</MudRadio>
                                <MudRadio Option="@("Option 2")" Color="Color.Primary">Option 2</MudRadio>
                            </MudRadioGroup>
                            
                            <MudDatePicker Label="Date Picker" />
                        </MudPaper>
                    </MudCardContent>
                </MudCard>
            </MudItem>
            
            <MudItem xs="12">
                <MudCard Elevation="0" Class="mt-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h5">Color Palette</MudText>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudGrid>
                            <MudItem xs="6" sm="4" md="3" lg="2">
                                <ColorSwatch Name="Primary" Color="@GetPaletteColor("Primary")" />
                            </MudItem>
                            <MudItem xs="6" sm="4" md="3" lg="2">
                                <ColorSwatch Name="Secondary" Color="@GetPaletteColor("Secondary")" />
                            </MudItem>
                            <MudItem xs="6" sm="4" md="3" lg="2">
                                <ColorSwatch Name="Tertiary" Color="@GetPaletteColor("Tertiary")" />
                            </MudItem>
                            <MudItem xs="6" sm="4" md="3" lg="2">
                                <ColorSwatch Name="Info" Color="@GetPaletteColor("Info")" />
                            </MudItem>
                            <MudItem xs="6" sm="4" md="3" lg="2">
                                <ColorSwatch Name="Success" Color="@GetPaletteColor("Success")" />
                            </MudItem>
                            <MudItem xs="6" sm="4" md="3" lg="2">
                                <ColorSwatch Name="Warning" Color="@GetPaletteColor("Warning")" />
                            </MudItem>
                            <MudItem xs="6" sm="4" md="3" lg="2">
                                <ColorSwatch Name="Error" Color="@GetPaletteColor("Error")" />
                            </MudItem>
                            <MudItem xs="6" sm="4" md="3" lg="2">
                                <ColorSwatch Name="Surface" Color="@GetPaletteColor("Surface")" />
                            </MudItem>
                            <MudItem xs="6" sm="4" md="3" lg="2">
                                <ColorSwatch Name="Background" Color="@GetPaletteColor("Background")" />
                            </MudItem>
                        </MudGrid>
                    </MudCardContent>
                </MudCard>
            </MudItem>
            
            <MudItem xs="12" Class="d-flex justify-end mt-4">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SaveThemeSettings" Class="mx-2">
                    Save Settings
                </MudButton>
                <MudButton Variant="Variant.Outlined" Color="Color.Primary" OnClick="ResetThemeSettings" Class="mx-2">
                    Reset to Default
                </MudButton>
            </MudItem>
        </MudGrid>
    </MudPaper>
</MudContainer>

@code {
    protected override void OnInitialized()
    {
        ThemeService.ThemeChanged += (sender, args) => StateHasChanged();
        base.OnInitialized();
    }
    
    private string GetPaletteColor(string propertyName)
    {
        var palette = ThemeService.IsDarkMode 
            ? ThemeService.CurrentTheme.Palette 
            : ThemeService.CurrentTheme.Palette;
            
        var property = palette.GetType().GetProperty(propertyName);
        return property?.GetValue(palette)?.ToString() ?? "#000000";
    }
    
    private async Task SaveThemeSettings()
    {
        await ThemeService.SaveThemePreference();
        Snackbar.Add("Theme settings saved successfully", Severity.Success);
    }
    
    private void ResetThemeSettings()
    {
        ThemeService.SetTheme(false); // Reset to light mode
        Snackbar.Add("Theme settings reset to default", Severity.Info);
    }
}
